install-dev:
    poetry install
    poetry run pip install ../.

install:
    poetry install
    poetry run pip install -U pytket

prepare:
    cp -R pytket-docs-theming/_static .
    cp pytket-docs-theming/conf.py .

build *SPHINX_ARGS: prepare
    VERSION=$(poetry run python -c "import pytket; print(pytket.__version__)") && \
    poetry run sphinx-build {{SPHINX_ARGS}} -b html . build -D html_title="pytket v$VERSION API documentation"

linkcheck: prepare
    poetry run sphinx-build -W -b linkcheck . build

coverage: prepare
    poetry run sphinx-build -W -v -b coverage . build/coverage

build-strict: prepare
    VERSION=$(poetry run python -c "import pytket; print(pytket.__version__)") && \
    just build -W # Fail on sphinx warnings
    just linkcheck
    just coverage

serve: build
    npm exec serve build

serve-debug:
    npm exec serve build

cleanup:
    # Clean up files generated by Sphinx
    rm -rf jupyter_execute
    rm -rf .jupyter_cache
    rm -rf build

    # Clean up config files in the event the build fails
    rm -rf _static
    rm -f conf.py