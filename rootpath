#!/usr/bin/env python

# Extract the root package path from the json output of `conan create`.

# Usage: ./rootpath <json_file> <package_name>

import json
import sys

jsonfile = sys.argv[1]
name = sys.argv[2]

with open(jsonfile, "r") as f:
    info = json.load(f)

if "graph" in info.keys():
    # generated by conan 2 with `--format json`
    nodes = [
        node for node in info["graph"]["nodes"] if node["ref"].startswith(f"{name}/")
    ]
    assert len(nodes) == 1
    node = nodes[0]
    print(node["package_folder"])
else:
    # genetated by conan 1 with `--json`
    assert not info["error"]
    installed = info["installed"]
    package_lists = [
        item["packages"] for item in installed if item["recipe"]["name"] == name
    ]
    assert len(package_lists) == 1
    package_list = package_lists[0]
    assert len(package_list) == 1
    package = package_list[0]
    print(package["cpp_info"]["rootpath"])
